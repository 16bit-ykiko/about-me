---
title: '写给 C++ 程序员的反射教程'
date: 2023-11-29 01:14:02
updated: 2024-01-23 08:11:02
type: 'post'
cover: 'https://pica.zhimg.com/v2-961a0e09aedd4f88351abc16989d49cc_720w.jpg?source=172ae18b'
---


反射相信这个词语大家都不陌生了，也许你没用过但是你一定听过。然而就如同计算机科学领域很多其它的惯用词一样，对于反射，并没有一个准确而清晰的定义。于是就会出现下面这种情况：像 C#，Java，Python 这些拥有反射的语言，对于它们的使用者来说，谈论到反射可以很自然的联想到对应语言中相关的设施，相关的函数，相关的代码示例，非常的具体。而对于那些没有反射的语言的使用者来说（例如 C/C++，Rust ），当谈论起反射的时候，大家都不确定对方说的是什么意思，非常的不具体。比如有人问告诉我 Rust 有反射，他给出的例子是 Rust 官方的 [文档](https://doc.rust-lang.org/stable/std/any/index.html) 里面对 std::Any 模块的介绍。里面提到了 Utilities for dynamic typing or type reflection（用于动态类型或动态反射的工具）。但是尴尬就尴尬在，你说它是反射吧，功能非常鸡肋，你说它不是吧，硬要说有这种体现也不是不行。

类似的情况在 C++ 中也经常发生。相信你也经常能听到如下观点：C++ 只有非常弱的反射 RTTI，但是 C++ 的一些框架比如 QT，UE 自己实现了反射。在最近的讨论中，网上的博客中又或者 C++ 新标准的提案中，你可能又会听到所谓：

- static reflection —— 静态反射
- dynamic reflection —— 动态反射
- compile time reflection —— 编译期反射
- runtime reflection —— 运行期反射


这样一大堆名词实在是让人听的云里雾里，晕头转向。而且 static，dynamic，compile time，runtime 这些前缀词也都是惯用词，甚至可以说经常被滥用，于语境不同有非常多的含义。

当然，为了方便交流，在日常的讨论中，我也会使用这些表意不明确的词来简明的表达观点。但是这样会导致一个问题，如果对方对这些东西也比较了解，那交流起来就很轻松。如果对方不是很了解，这样的描述会导致误解被进一步扩大。也经常会有人在交流中提问： **什么是反射？** 对于这样的提问，我常常是无能为力的，因为我知道三言两语是说不清的。而且前文也提到了，这个东西其实本来就没有准确的定义，所以也没法通过下定义的方式来回复。虽然 [wiki](https://en.wikipedia.org/wiki/Reflective_programming) 上是有定义的：

>  In computer science, reflective programming or reflection is the ability of a process to examine, introspect, and modify its own structure and behavior. 反射是程序具有自省，检查和修改它自身结构和行为的一种能力。

但是这个定义说了和没说一样，即使发出来了也没什么帮助。当遇到类似的情况，比如有人问 C++ TMP 是什么？这种时候我会把我认为非常好的教程发给提问者，这样也就圆满解决了问题。 于是我就想能不能发一篇关于反射的教程过去呢？很可惜的是，在中文互联网上搜索到的内容都是具体到某个语言的。比如 Python，Java 里面的机制，而且是具体到如何使用，也就是讨论 API，讨论实现的并不多。如果把搜索关键字精确到  **C++ 反射** ，在知乎上倒是有各种各样的反射实现方案。但是可惜的是他们都侧重于实现，而都没有仔细地讨论反射这个概念。而且不同的实现上还会牵扯到宏，模板这些繁琐的细节，更加让人难以理解了，而且好像让人觉得没有这些就不能实现反射了。总之，目前还没有什么详细讨论反射这个概念的文章，于是我就想结合自己的理解来编写系列文章。

主要目的就是为了让和我一样想搞懂反射的小伙伴，少走些弯路。由于反射没有一个准确的定义，所以我选择把它拆分成几个过程进行解释，这样我们就不用去纠结「 **反射究竟是什么** 」这个概念问题了。取而代之的是，弄明白了这几个过程，自然而然的你就明白反射是在做什么事情了。

系列文章共有五篇，不仅仅讨论概念，后面也会教你如何利用外部工具